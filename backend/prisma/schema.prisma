// Security System Database Schema
// Simplified for person detection and door control

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  firstName String?  @map("first_name")
  lastName  String?  @map("last_name")
  role      UserRole @default(USER)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

// Camera model
model Camera {
  id          Int      @id @default(autoincrement())
  name        String
  location    String?
  streamUrl   String?  @map("stream_url")
  webrtcUrl   String?  @map("webrtc_url")
  isActive    Boolean  @default(true) @map("is_active")
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  events Event[]

  @@map("cameras")
}

// Event model for person detection alerts
model Event {
  id           Int       @id @default(autoincrement())
  cameraId     Int       @map("camera_id")
  eventType    EventType @default(PERSON_DETECTED) @map("event_type")
  personCount  Int       @default(0) @map("person_count")
  confidence   Float?    // AI detection confidence
  snapshotPath String?   @map("snapshot_path") // Path to saved image
  description  String?
  isResolved   Boolean   @default(false) @map("is_resolved")
  createdAt    DateTime  @default(now()) @map("created_at")
  resolvedAt   DateTime? @map("resolved_at")

  // Relations
  camera Camera @relation(fields: [cameraId], references: [id])

  @@map("events")
}

// Enums
enum UserRole {
  ADMIN
  USER
}

enum EventType {
  PERSON_DETECTED
  MULTIPLE_PERSONS
  DOOR_OPENED
  DOOR_CLOSED
  SYSTEM_ALERT
}